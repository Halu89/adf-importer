modules:
  jira:issueActivity:
    - key: adf-importer-hello-world-issue-activity
      resource: main
      resolver:
        function: resolver
      render: native
      title: adf-importer

  function:
    - key: resolver
      handler: index.handler

    - key: handleAttachmentAdded
      handler: index.handleAttachmentAdded

    - key: handleAttachmentDeleted
      handler: index.handleAttachmentDeleted

    - key: handleIssueDeleted
      handler: index.handleIssueDeleted

    - key: handleIssueUpdated
      handler: index.handleIssueUpdated

  trigger:
    - key: issue-attachment-added
      function: handleAttachmentAdded
      events:
        - avi:jira:created:attachment
      filter:
        ignoreSelf: true
        onError: RECEIVE_AND_LOG

    - key: issue-attachment-deleted
      function: handleAttachmentDeleted
      events:
        - avi:jira:deleted:attachment
      filter:
        ignoreSelf: true
        onError: RECEIVE_AND_LOG

    - key: issue-deleted
      function: handleIssueDeleted
      events:
        - avi:jira:deleted:issue
      filter:
        ignoreSelf: true
        onError: RECEIVE_AND_LOG

    - key: issue-updated
      function: handleIssueUpdated
      events:
        - avi:jira:updated:issue
      filter:
        ignoreSelf: true
        onError: RECEIVE_AND_LOG


permissions:
  scopes:
    - "read:jira-work" # Read events and attachments from Jira issues
    - "write:jira-work" # Create comments on Jira issues
    - "write:page:confluence" # Create pages in Confluence
    - "storage:app" # Store references to pages created from attachments

resources:
  - key: main
    path: src/frontend/index.jsx

app:
  # Preview Multi-app support
  runtime:
    name: nodejs22.x
    memoryMB: 256
    architecture: arm64
  id: ari:cloud:ecosystem::app/c2decf0d-0aa0-4ac9-bc64-4e3fb6d21205
  compatibility:
    confluence:
      required: false
    jira:
      required: true

